name: Build app and deploy to testServer
on:
#触发事件，当收到推送的时候执行
 push:
   branches:
   - main
  
jobs:
    # 任务ID
    build:
      # 运行环境
      runs-on: ubuntu-latest
      # 步骤
      steps:
      - name: Checkout Code
      # 使用别人的action
        uses: actions/checkout@v2
      # 步骤名称
      - name: use node
        uses: actions/setup-node@v2.5.1
        with:
          node-version: 18 # node版本
      
      - name: Install dependencies
        run: yarn
   
      - name: build
        run: npm run build
        
      # 命名这个任务为发布Deploy
      - name: Deploy
        # 因为构建之后，需要把代码上传到服务器上，所以需要连接到ssh，并且做一个拷贝操作
        uses: cross-the-world/scp-pipeline@master
        env:
          WELCOME: "ssh scp ssh pipelines"
          LASTSSH: "Doing something after copying"
        with:
          host: ${{ secrets.USER_HOST }}
          user: ${{ secrets.USER_NAME }}
          pass: ${{ secrets.USER_PASS }}
          port: 22
          connect_timeout: 10s
       #将dist所有的文件传输到服务器
          local: './home/pages/admin/*'
     #remote推送的是服务器内的文件地址,修改成你自己的文件地址
